function get_product_d(t){id=t.getAttribute("id"),bid=id.split("_"),bid=bid[1],plist="",pid=$("#"+id+" option:selected").val(),""!==pid?($(".loading").show(),$.ajax({url:base_url+"product/getPdetails",type:"POST",data:{pid:pid},success:function(t){data=JSON.parse(t),"success"==data.data?($(".loading").hide(),$("#invb_"+bid+" option").each((t,a)=>{a.getAttribute("value")==data.e.billing_cycle&&a.setAttribute("selected","true")}),n=data.e.product_service_name.replaceAll(/[^\w\s]/gi,"").replaceAll(" ","").toLowerCase(),$("#plistInv #p"+bid).length?(pi='<span id="sn'+bid+'"></span><br> ('+data.pm+" + ["+data.sf+" - setup fee])",$("#n"+bid).html("<b>"+data.e.product_service_name+"</b>"+pi),$("#rs"+bid).html(data.p+"/"),$("#p"+bid).attr("data-p",data.p),$("#p"+bid).attr("data-r",data.e.recurring),$("#p"+bid).attr("data-i",n),makeSubTotal(bid,n)):(plist+='<tr id="p'+bid+'" data-i="'+n+'" data-p="'+data.p+'" data-un="'+data.p+'" data-r="'+data.e.recurring+'">',plist+='<td class="border-linenone" id="n'+bid+'"><b>'+data.e.product_service_name+"</b>",plist+='<span id="sn'+bid+'"></span><br> ('+data.pm+" + ["+data.sf+" - setup fee])",plist+="</td>",plist+='<td class="border-linenone" id="rs'+bid+'" style="text-align:right;">'+data.p+"/</td>",plist+="</tr>",$("#plistInv").append(plist),makeSubTotal(bid,n))):(alert("Product is not selected!"),$(".loading").hide())}})):($("#p"+bid).remove(),makeSubTotal())}function reflectS(t){id=t.getAttribute("id"),n=id.split("_"),n=n[1];let a=$("#"+id).val();$("#sn"+n).html(" ["+a+"]")}function makeSubTotal(t="",a=""){let e=0,i=0;$("#plistInv tr").each((t,a)=>{p=a.getAttribute("data-p"),r=a.getAttribute("data-r");var d=p.match(/[+-]?\d+(\.\d+)?/g).map(function(t){return Number(t)});i+=Number(r),e+=d[0]});let d=$("#discount").html();NaN!==d&&""!==d&&"undefined"!==d&&(e-=Number(d)),$("#subtotal").html(parseFloat(e).toFixed(2)),$("#totalP").html(parseFloat(e).toFixed(2)),$("#recurring").html(parseFloat(i).toFixed(2)),gstCalc()}function gstCalc(){"yes"===$("#inv_gst").val()?($("#gstRow").show(),float=Number($("#subtotal").html()),totalP=Number($("#totalP").html()),gstT=gst*float/100,$("#gsttotal").html(parseFloat(gstT).toFixed(2)),$("#totalP").html(parseFloat(gstT+float).toFixed(2))):($("#gstRow").hide(),float=Number($("#subtotal").html()),$("#totalP").html(parseFloat(float).toFixed(2)))}function overRideP(t){id=t.getAttribute("id"),id=id.split("_"),id=id[1];let a=$("#invO_"+id).val(),e="<?=get_config_item('default_currency')?>",i="<?=get_config_item('currency_decimals')?>";var d="";isNaN(a)||""===a?($("#p"+id).attr("data-p",$("#p"+id).attr("data-un")),$("#rs"+id).html($("#p"+id).attr("data-un")),makeSubTotal()):""!==(d=e+a+".0".repeat(i))&&($("#p"+id).attr("data-p",d),$("#rs"+id).html(d),makeSubTotal())}function removeInvMe(t){$("#id"+t).remove(),$("#p"+t).remove(),makeSubTotal()}makeSubTotal(),gstCalc(),$("#inv_create_date").datetimepicker({format:date_format,timepicker:!1}),$("#inv_due_date").datetimepicker({format:date_format,timepicker:!1}),$("#apc").click(function(){let t=$("#coupon").val();$(".loading").show(),!isNaN(t)&&""!==t&&Number(t)<=Number($("#subtotal").html())?($("#disRow").show(),$("#discount").html(t),makeSubTotal(),$(".loading").hide()):($("#disRow").hide(),$("#discount").html(0),makeSubTotal(),$(".loading").hide())}),$("#invForm").submit(()=>{$(".loading").show()}),$(function(){$("#inv_cname").autocomplete({source:base_url+"client/search_match",select:function(t,a){t.preventDefault(),$("#client_id").val(a.item.id),$("#gstnumber").length&&$("#gstnumber").val(a.item.gst),$("#pannumber").length&&$("#pannumber").val(a.item.pan),$("#cinnumber").length&&$("#cinnumber").val(a.item.cin)},minLength:3}),$(".ui-menu").css("z-index","99999999999999")});